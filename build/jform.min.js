(function(){var b=function(){this.modules={};this.plugins={}};b.prototype.register=function(d,c,e){if(this.modules[d]){console.info("/! Module '"+d+"' is already defined. Duplicate:",e);return false}else{this.modules[d]=c;return true}};b.prototype.plugin=function(d,f,e,c){if(this.plugins[d]&&!c){console.info("/! Plugin '"+d+"' is already defined. Duplicate:",e);return false}else{this.plugins[d]=f;return true}};b.prototype.dom=function(c,e,d){var f=document.createElement(c);if(e!=undefined){$(e).append($(f))}return(d===true)?f:$(f)};var a=function(){this.fields={};this.data={};this.errors=[];this.theme={line:{classname:"form-group",type:"div"},label:{classname:"control-label",type:"label"},field:{classname:false,type:"div"}};var c=this;var d;for(d in window.jformFactory.plugins){if(this[d]){console.error("/! Plugin '"+d+"' was refused. This name is either already in use internally or already registered by another plugin.")}else{this[d]=window.jformFactory.plugins[d](this);console.log("Plugin '"+d+"' has been installed.",this[d])}}this.conditionFramework=function(e){if(!c.fields[e]){console.error("/! field '"+e+"' desn't exist.");return this}this.field=c.fields[e];return this};this.conditionFramework.prototype.equal=function(e){if(!this.field){console.error("/! Condition: No field selected.");return false}if(!this.field.active){return false}if(this.field.instance.validate()&&this.field.instance.val()==e){return true}return false};this.conditionFramework.prototype.contains=function(g){if(!this.field){console.error("/! Condition: No field selected.");return false}if(!this.field.active){return false}var f=this;if(_.isArray(g)){if(!f.field.instance.validate()){return false}var e=true;_.each(g,function(h){e&=_.contains(f.field.instance.val(),h)});return e}else{if(this.field.instance.validate()&&_.contains(this.field.instance.val(),g)){return true}}return false}};a.prototype.build=function(c,d){var e=this;this.options=_.extend({form:{},submit:$(),onSubmit:function(){},onError:function(){}},d);this.container=c;_.each(this.options.form,function(h){if(h.condition&&typeof h.condition=="string"){(function(i){i.condition=new Function("scope","with(scope){return "+i.condition+";}")(this)})(h)}if(e.fields[h.name]){console.info("/! field '"+h.name+"' is already defined. Duplicate:",e.fields[h.name]);return this}else{if(!window.jformFactory.modules[h.type]){console.info("/! factory '"+h.type+"' doesn't exist on ",h);return this}else{var f=new window.jformFactory.modules[h.type](e,h);var g=e.createLine(h);f.build(g);f.onUpdate(function(){e.executeConditions()});e.fields[h.name]={factory:window.jformFactory.modules[h.type],instance:f,data:h,line:g,active:true};g.line.hide()}return this}});this.options.submit.unbind("click").bind("click",function(){if(e.validate()){e.options.onSubmit(e.data,e)}else{e.options.onError(e.errors,e)}});this.executeConditions();return this};a.prototype.validate=function(e){var d;this.data={};this.errors=[];var c=false;for(d in this.fields){if(this.fields[d].active){if(!this.fields[d].instance.validate()){c|=true;this.errors.push({field:this.fields[d],name:d})}else{this.data[d]=this.fields[d].instance.val()}}}if(c){return false}else{return true}};a.prototype.executeConditions=function(){var c;var d=0;for(c in this.fields){if(this.fields[c].data.condition){if(this.fields[c].data.condition(this.conditionFramework)){if(this.fields[c].active!=true){d++;this.fields[c].active=true;this.fields[c].line.line.slideDown()}}else{if(this.fields[c].active!=false){d++;this.fields[c].active=false;this.fields[c].line.line.slideUp()}}}else{this.fields[c].line.line.slideDown()}}if(d>0){this.executeConditions()}};a.prototype.createLine=function(e){var c=window.jformFactory.dom(this.theme.line.type,this.container);if(this.theme.line.classname){c.addClass(this.theme.line.classname)}var d=window.jformFactory.dom(this.theme.label.type,c);d.html(e.label);if(this.theme.label.classname){d.addClass(this.theme.label.classname)}var f=window.jformFactory.dom(this.theme.field.type,c);if(this.theme.field.classname){f.addClass(this.theme.field.classname)}return{line:c,label:d,field:f}};a.prototype.stringify=function(d){var c=[];_.each(this.options.form,function(e){var f=_.extend({},e);if(f.condition&&typeof f.condition!="string"){f.condition=f.condition.toString().replace(/\/\*[.\r\n\t\w\W\s]*\*\//,"").replace(/\/\/(.*)[\r\n]/gm,"").replace(/[\t\r\n]/gm,"")}c.push(f)});if(d){return JSON.stringify(c,null,4)}else{return JSON.stringify(c)}};window.jformFactory=new b();window.jform=a})();(function(){window.jformFactory.plugin("bootstrap",function(a){return{showErrors:function(){a.container.find(".has-error").removeClass("has-error");if(a.errors.length>0){_.each(a.errors,function(b){b.field.line.line.addClass("has-error")})}},resetErrors:function(){a.container.find(".has-error").removeClass("has-error")}}},{description:"Bootstrap: Utilities to manage bootstrap forms like showing errors for example.",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c;this.value=[];this.onUpdateCallback=function(){}};a.prototype.build=function(b){var c=this;this.line=b;_.each(this.data.list,function(f){var h=_.uniqueId(c.data.name);var d=window.jformFactory.dom("div",b.field);d.addClass("checkbox");var g=window.jformFactory.dom("input",d,true);g.type="checkbox";g=$(g);g.attr("id",h);g.click(function(){if(g.is(":checked")){c.value.push(f.value);c.value=_.uniq(c.value)}else{c.value=_.without(c.value,f.value)}c.onUpdateCallback()});var e=window.jformFactory.dom("label",d);e.html(f.label);e.attr("for",h)})};a.prototype.validate=function(b){if(this.value.length>0){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.value=b()}else{return this.value}};a.prototype.onUpdate=function(b){this.onUpdateCallback=b};a.prototype.remove=function(){};window.jformFactory.register("checkbox",a,{description:"Checkbox, simple checkbox list",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c;this.value="";this.onUpdateCallback=function(){}};a.prototype.build=function(b){var d=this;this.line=b;var c=_.uniqueId(d.data.name);_.each(this.data.list,function(g){var i=_.uniqueId(d.data.name);var e=window.jformFactory.dom("div",b.field);e.addClass("radio");var h=window.jformFactory.dom("input",e,true);h.type="radio";h=$(h);h.attr("id",i);h.attr("name",c);h.attr("value",g.value);h.click(function(){d.onUpdateCallback()});var f=window.jformFactory.dom("label",e);f.html(g.label);f.attr("for",i)})};a.prototype.validate=function(b){if(this.val()&&this.val()!=""){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.value=b()}else{return this.line.field.find("input[type=radio]:checked").val()}};a.prototype.onUpdate=function(b){this.onUpdateCallback=b};a.prototype.remove=function(){};window.jformFactory.register("radio",a,{description:"Radio, simple radio list",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,c){this.jform=b;this.data=c};a.prototype.build=function(b){this.line=b;this.field=window.jformFactory.dom("input",b.field,true);this.field.type="varchar";this.field=$(this.field);this.field.addClass("form-control")};a.prototype.validate=function(b){if(this.val().trim()!=""){return true}return false};a.prototype.val=function(b){if(b&&b!==false){this.field.val(b)}else{return this.field.val()}};a.prototype.onUpdate=function(b){this.field.bind("change",b)};a.prototype.remove=function(){};window.jformFactory.register("varchar",a,{description:"Varchar, simple input text, single line.",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();